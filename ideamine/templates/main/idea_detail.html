{% extends "main.html" %}
{% load comments %}

{% block title %}{{ object.short_name|title }}{% endblock %}

{% block head %}{% endblock %}

{% block content %}
{% if form %}
<form action="{% url idea_update object.pk %}" method="post">
  <table>
	{{ form.as_table }}
  </table>
  {% csrf_token %}
  <input type="submit" value="Update Idea">
</form>
{% else %}
<h2>{{ object.short_name|title }}</h2>
<table>
  <tr>
	<th>Owner:</th>
	<td><a href="{% url user_detail object.owner.user.id %}">{{ object.owner }}</a></td>
  </tr>
  <tr>
	<th>Created:</th>
	<td>{{ object.created_at }}</td>
  </tr>
  <tr>
	<th>Tags:</th>
	<td><ul>{{ object.tags.all|unordered_list }}</ul></td>
  </tr>
  <tr>
	<th>Current Members:</th>
	<td>{{ object.members.all.count }}</td>
  </tr>
</table>
{% endif %}

{% if can_delete %}
<form action="{% url idea_destroy object.pk %}" method="post">
  {% csrf_token %}
  <input type="submit" value="Delete Idea">
</form>
{% endif %}

{% with object.unconfirmed_members as object_list %}
{% with True as edit %}
{% if object_list %}
<table>
  <tr>
	<th>pk</th>
	<th>username</th>
	<th>first_name</th>
	<th>last_name</th>
	<th>email</th>
	<th>is_staff</th>
	<th>is_active</th>
	<th>is_superuser</th>
	<th>last_login</th>
	<th>date_joined</th>
  </tr>
 {% for member in object_list %}
  <tr>
	<td>{{ member.pk }}</td>
	<td>{{ member.username }}</td>
	<td>{{ member.first_name }}</td>
	<td>{{ member.last_name }}</td>
	<td>{{ member.email }}</td>
	<td>{{ member.is_staff }}</td>
	<td>{{ member.is_active }}</td>
	<td>{{ member.is_superuser }}</td>
	<td>{{ member.last_login }}</td>
	<td>{{ member.date_joined }}</td>
	<td>
	<form method="post" action="{% url idea_confirm_member object.pk member.user.pk %}">
	  {% csrf_token %}
	  <input type="submit" value="Confirm Member" />
	</form>
  </td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>{{ emptymessage|default:'No Users' }}</p>
{% endif %}
{% endwith %}{% endwith %}

{% if not user.get_profile in object.members.all %}
<form method = "post" action = "{% url user_join_idea object.pk %}">
  {% csrf_token %}
  <input type = "submit" value = "Join Project" />
</form>
{% else %}
<form method = "post" action = "{% url user_leave_idea object.pk %}">
  {% csrf_token %}
  <input type = "submit" value = "Leave Project" />
</form>
{% endif %}

<h3>Description</h3>
<p>{{ object.desc }}</p>

<h3>Images</h3>
{% if object.images %}
{% for img in object.images.all %}
<p><img src="{{ img.get_absolute_url }}"/></p>
{% endfor %}
{% else %}
<p>No images uploaded.</p>
{% endif %}

{% if form %}
<a href="{% url image_upload object.pk %}">Upload an image</a>
{% endif %}

<h3>Comments</h3>
{% render_comment_list for object %}
{% if user.is_authenticated %}
{% render_comment_form for object %}
<a href="{% url image_upload object.pk %}">Upload an image</a>
{% endif %}
{% endblock %}
